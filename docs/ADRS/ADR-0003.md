# ADR-0003: Environment Resolution & API Bases

- Status: Accepted
- Date: 2024-06-01

## Context

Inconsistent handling of dev/prod environments led to accidental localhost calls in packaged builds and confusion between worker and service endpoints.

## Decision

Centralize environment selection using Vite-provided `VITE_*` variables in the desktop app, `SERVER_ENV`/`ENVIRONMENT` in Python services, and `LICENSING_ENV` in the Cloudflare Worker. Provide explicit host mappings for dev and prod, forbidding `localhost` defaults in production builds.

## Consequences

- Desktop builds must read hosts from env vars at runtime; release builds will fail CI if `localhost` is detected.
- Python services load configuration through `server/config.py` to ensure consistent secrets per environment.
- Infrastructure tooling must publish host and namespace mappings alongside deploy artifacts so other layers remain in sync.
